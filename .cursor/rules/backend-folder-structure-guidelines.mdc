---
description: Folder structure and naming conventions for NestJS project organization
globs:
alwaysApply: false
---

# Folder Structure Guidelines

## 1. Monorepo Structure

### Root Level Organization

```bash
ruum-backend/
├── .cursor/
├── .github/                 # GitHub workflows and templates       # Cursor IDE rules
├── apps/                    # Microservices and applications
├── libs/                    # Shared libraries and modules
├── docs/                    # Documentation
├── scripts/                 # Build and deployment scripts
├── generated/               # Generated code (Prisma client)
├── prisma/                  # Database schema and migrations
├── .dockerignore
├── .env.example
├── .gitignore
├── .prettierrc
├── commitlint.config.js
├── docker-compose.yml
├── Dockerfile
├── eslint.config.mjs
├── jest.config.js
├── nest-cli.json
├── package.json
├── tsconfig.build.json
├── tsconfig.json
└── README.md
```

### Apps Directory Structure

```bash
apps/
└── api-gateway/             # Main API gateway service
    ├── src/
    │   ├── main.ts
    │   ├── app.module.ts
    │   ├── auth/               # Authentication module
    │   │   ├── auth.module.ts
    │   │   ├── application/    # Services and use cases
    │   │   │   ├── services/
    │   │   │   │   ├── auth.service.ts
    │   │   │   │   └── auth.service.spec.ts
    │   │   │   └── use-cases/
    │   │   │       ├── log-in.use-case.ts
    │   │   │       ├── sign-up.use-case.ts
    │   │   │       ├── refresh.use-case.ts
    │   │   │       └── ...
    │   │   ├── domain/         # Value objects
    │   │   │   └── value-objects/
    │   │   │       └── jwt-payload.ts
    │   │   ├── infrastructure/ # Controllers, strategies, security
    │   │   │   ├── controllers/
    │   │   │   │   ├── auth.controller.ts
    │   │   │   │   └── access.controller.ts
    │   │   │   ├── strategies/
    │   │   │   │   ├── jwt.strategy.ts
    │   │   │   │   └── local.strategy.ts
    │   │   │   ├── security/
    │   │   │   │   └── jwt-token.service.ts
    │   │   │   ├── transformers/
    │   │   │   │   ├── auth.transformer.ts
    │   │   │   │   └── access.transformer.ts
    │   │   │   └── notifications/
    │   │   │       ├── access-verify-email.notification.ts
    │   │   │       └── ...
    │   │   └── tests/
    │   │       └── fixtures/
    │   ├── users/              # User management module
    │   │   ├── users.module.ts
    │   │   ├── application/
    │   │   │   ├── mappers/
    │   │   │   │   ├── user.mapper.ts
    │   │   │   │   └── user.mapper.spec.ts
    │   │   │   ├── services/
    │   │   │   │   ├── users.service.ts
    │   │   │   │   └── users.service.spec.ts
    │   │   │   └── use-cases/
    │   │   │       ├── users.use-case.ts
    │   │   │       └── users.use-case.spec.ts
    │   │   ├── domain/
    │   │   │   ├── user.entity.ts
    │   │   │   ├── user.entity.spec.ts
    │   │   │   ├── user.repository.ts
    │   │   │   ├── user.repository.spec.ts
    │   │   │   └── events/
    │   │   │       ├── user-created.event.ts
    │   │   │       ├── user-updated.event.ts
    │   │   │       └── ...
    │   │   ├── infrastructure/
    │   │   │   ├── controllers/
    │   │   │   │   ├── admin-users.controller.ts
    │   │   │   │   └── admin-users.controller.spec.ts
    │   │   │   ├── repository/
    │   │   │   │   ├── mock-user.repository.ts
    │   │   │   │   └── mock-user.repository.spec.ts
    │   │   │   └── notifications/
    │   │   │       ├── user-autogenerated-password.notification.ts
    │   │   │       └── user-password-modified.notification.ts
    │   │   └── tests/
    │   │       └── fixtures/
    │   ├── index/              # Health check and basic endpoints
    │   │   ├── index.module.ts
    │   │   ├── application/
    │   │   │   ├── index.service.ts
    │   │   │   └── index.service.spec.ts
    │   │   └── infrastructure/
    │   │       ├── index.controller.ts
    │   │       └── index.controller.spec.ts
    │   └── common/             # Common utilities and configurations
    │       ├── config/
    │       ├── examples/
    │       ├── guards/
    │       ├── middlewares/
    │       ├── services/
    │       └── test/
    ├── test/
    │   ├── index.e2e-spec.ts
    │   └── jest-e2e.json
    └── tsconfig.app.json
```

## 2. Clean Architecture Structure

### Domain-Driven Design Layers (Current Implementation)

```bash
users/
├── users.module.ts
├── application/             # Application layer
│   ├── services/            # Business logic services
│   │   ├── users.service.ts
│   │   ├── users.service.spec.ts
│   │   └── ...
│   ├── use-cases/           # Complex business workflows
│   │   ├── users.use-case.ts
│   │   ├── users.use-case.spec.ts
│   │   └── ...
│   └── mappers/             # Data transformation mappers
│       ├── user.mapper.ts
│       ├── user.mapper.spec.ts
│       └── ...
├── domain/                  # Domain layer (entities, repositories)
│   ├── entities/            # Domain entities
│   │   ├── user.entity.ts
│   │   ├── user.entity.spec.ts
│   │   └── ...
│   ├── repositories/        # Repository interfaces
│   │   ├── user.repository.ts
│   │   ├── user.repository.spec.ts
│   │   └── ...
│   └── events/              # Domain events
│       ├── user-created.event.ts
│       ├── user-updated.event.ts
│       └── ...
└── infrastructure/          # Infrastructure layer (implementations)
    ├── controllers/         # HTTP controllers
    │   ├── admin-users.controller.ts
    │   ├── admin-users.controller.spec.ts
    │   └── ...
    ├── repository/          # Repository implementations (singular)
    │   ├── mock-user.repository.ts
    │   ├── mock-user.repository.spec.ts
    │   └── ...
    ├── transformers/        # Response transformers
    │   ├── user.transformer.ts
    │   └── ...
    └── notifications/       # Notification handlers
        └── ...
```

## 3. Shared Libraries Structure

### Libs Organization

```bash
libs/
├── common/                  # Shared common utilities
│   └── src/
│       ├── common.module.ts
│       ├── config/         # Configuration files
│       │   └── index.ts
│       ├── dtos/           # Common DTOs
│       │   ├── filter.dto.ts
│       │   ├── state-archive.dto.ts
│       │   ├── state-delete.dto.ts
│       │   └── index.ts
│       ├── enums/          # Common enums
│       │   ├── headers.enum.ts
│       │   ├── state-archive.enum.ts
│       │   ├── state-delete.enum.ts
│       │   ├── locale-code.enum.ts
│       │   └── index.ts
│       ├── literals/       # String literals and constants
│       │   ├── filter.literals.ts
│       │   ├── state-archive.literals.ts
│       │   ├── state-delete.literals.ts
│       │   ├── store.literals.ts
│       │   └── index.ts
│       ├── pipes/          # Custom pipes
│       │   ├── object-id.pipe.ts
│       │   └── index.ts
│       ├── responses/      # Response type system
│       │   ├── enums/
│       │   │   ├── cancellation-reason.enum.ts
│       │   │   ├── response-status.enum.ts
│       │   │   ├── timeout-type.enum.ts
│       │   │   └── index.ts
│       │   ├── types/
│       │   │   ├── base-response.types.ts
│       │   │   ├── success-response.types.ts
│       │   │   ├── error-response.types.ts
│       │   │   ├── warning-response.types.ts
│       │   │   ├── info-response.types.ts
│       │   │   ├── partial-response.types.ts
│       │   │   ├── pending-response.types.ts
│       │   │   ├── processing-response.types.ts
│       │   │   ├── cancelled-response.types.ts
│       │   │   ├── cursor-response.types.ts
│       │   │   ├── paginated-response.types.ts
│       │   │   ├── timeout-response.types.ts
│       │   │   ├── response.types.ts
│       │   │   └── index.ts
│       │   └── index.ts
│       ├── services/       # Common services
│       │   ├── code.service.ts       # Code generation service
│       │   ├── hash.service.ts       # Hashing service
│       │   ├── time.service.ts       # Time utilities
│       │   ├── *.spec.ts            # Service tests
│       │   ├── test/                # Mock services
│       │   │   ├── code.service.mock.ts
│       │   │   ├── hash.service.mock.ts
│       │   │   └── time.service.mock.ts
│       │   └── index.ts
│       ├── transformers/   # Data transformers
│       │   ├── to-object-id.transformer.ts
│       │   └── index.ts
│       ├── types/          # Common type definitions
│       │   ├── non-functional-properties.type.ts
│       │   ├── cls-store.type.ts
│       │   └── index.ts
│       └── index.ts
├── contracts/              # Shared contracts, DTOs, and API definitions
│   └── src/
│       ├── auth/           # Authentication contracts
│       │   ├── decorators/
│       │   │   ├── authenticated.decorator.ts
│       │   │   ├── get-auth.decorator.ts
│       │   │   ├── public.decorator.ts
│       │   │   ├── unverified.decorator.ts
│       │   │   └── index.ts
│       │   ├── dtos/
│       │   │   ├── auth-sign-up.dto.ts
│       │   │   ├── auth-log-in.dto.ts
│       │   │   ├── auth-verify-email.dto.ts
│       │   │   ├── auth-forgot-password.dto.ts
│       │   │   └── index.ts
│       │   ├── enums/
│       │   │   ├── auth-reason.enum.ts
│       │   │   └── index.ts
│       │   ├── guards/
│       │   │   ├── auth.guard.ts
│       │   │   ├── admin.guard.ts
│       │   │   └── index.ts
│       │   ├── literals/
│       │   │   ├── auth.literals.ts
│       │   │   ├── access.literals.ts
│       │   │   └── index.ts
│       │   ├── responses/
│       │   │   ├── auth.response.ts
│       │   │   ├── access-token.response.ts
│       │   │   └── index.ts
│       │   └── index.ts
│       ├── user/           # User management contracts
│       │   ├── dtos/
│       │   │   ├── user-create.dto.ts
│       │   │   ├── user-update.dto.ts
│       │   │   ├── user-filter.dto.ts
│       │   │   └── index.ts
│       │   ├── enums/
│       │   │   ├── user-role.enum.ts
│       │   │   └── index.ts
│       │   ├── literals/
│       │   │   ├── user.literals.ts
│       │   │   └── index.ts
│       │   ├── models/
│       │   │   ├── user.model.ts
│       │   │   └── index.ts
│       │   └── index.ts
│       ├── event/          # Event system contracts
│       │   ├── literals/
│       │   │   ├── event.literals.ts
│       │   │   └── index.ts
│       │   ├── models/
│       │   │   ├── event.model.ts
│       │   │   └── index.ts
│       │   └── index.ts
│       ├── notification/   # Notification system contracts
│       │   ├── literals/
│       │   │   ├── mail.literals.ts
│       │   │   └── index.ts
│       │   ├── models/
│       │   │   ├── notification.model.ts
│       │   │   └── index.ts
│       │   └── index.ts
│       └── index.ts
├── database/               # Database services and providers
│   └── src/
│       ├── database.module.ts
│       ├── prisma/
│       │   ├── prisma.service.ts
│       │   ├── prisma-log.enum.ts
│       │   ├── prisma-multi-tenant.factory.ts
│       │   └── test/
│       │       └── prisma.service.mock.ts
│       ├── mongo/
│       │   └── mongo.provider.ts
│       └── index.ts
├── environment/            # Environment configuration and validation
│   └── src/
│       ├── env.config.ts
│       ├── env.validation.ts
│       ├── test/
│       │   └── env.config.mock.ts
│       └── index.ts
├── events/                 # Event sourcing and domain events
│   └── src/
│       ├── events.module.ts
│       ├── application/
│       │   ├── events.service.ts
│       │   └── events.service.spec.ts
│       ├── domain/
│       │   ├── event.entity.ts
│       │   ├── event.entity.spec.ts
│       │   ├── event.repository.ts
│       │   └── event.repository.spec.ts
│       ├── infrastructure/
│       │   ├── mock-event.repository.ts
│       │   └── mock-event.repository.spec.ts
│       ├── test/
│       │   └── event-emitter.mock.ts
│       └── index.ts
├── observability/         # Observability and monitoring
│   └── src/
│       ├── observability.module.ts
│       ├── posthog/
│       │   ├── posthog.module.ts
│       │   ├── posthog.service.ts
│       │   └── index.ts
│       ├── sentry.config.ts
│       └── index.ts
└── notifications/          # Notification system (email, SMS, push)
    └── src/
        ├── notifications.module.ts
        ├── application/
        │   ├── notifications.service.ts
        │   ├── notifications.service.spec.ts
        │   ├── mailjet.service.ts
        │   └── mailjet.service.spec.ts
        ├── domain/
        │   ├── enums/
        │   │   ├── notification-type.enum.ts
        │   │   ├── notification-status.enum.ts
        │   │   ├── notification-channel.enum.ts
        │   │   └── mailjet-template-id.enum.ts
        │   ├── notification.entity.ts
        │   ├── notification.entity.spec.ts
        │   ├── notification.repository.ts
        │   └── notification.repository.spec.ts
        ├── infrastructure/
        │   ├── mock-notification.repository.ts
        │   └── mock-notification.repository.spec.ts
        ├── test/
        │   └── notifications.service.mock.ts
        └── index.ts
```

## 4. Naming Conventions

### File Naming

- **Controllers**: `*.controller.ts`
- **Services**: `*.service.ts`
- **Modules**: `*.module.ts`
- **Entities**: `*.entity.ts`
- **DTOs**: `*.dto.ts`
- **Guards**: `*.guard.ts`
- **Interceptors**: `*.interceptor.ts`
- **Filters**: `*.filter.ts`
- **Pipes**: `*.pipe.ts`
- **Decorators**: `*.decorator.ts`
- **Interfaces**: `*.interface.ts`
- **Types**: `*.type.ts`
- **Enums**: `*.enum.ts`
- **Constants**: `*.constant.ts`
- **Use Cases**: `*.use-case.ts`
- **Repositories**: `*.repository.ts`
- **Mappers**: `*.mapper.ts`
- **Events**: `*.event.ts`
- **Value Objects**: `*.value-object.ts`

### Class Naming

- **Controllers**: `UserController`, `AuthController`
- **Services**: `UserService`, `CreateUserService`
- **Use Cases**: `CreateUserUseCase`, `UpdateUserUseCase`
- **Entities**: `User`
- **DTOs**: `CreateUserDto`, `UpdateUserDto`
- **Guards**: `JwtAuthGuard`, `RolesGuard`
- **Interceptors**: `LoggingInterceptor`, `TransformInterceptor`
- **Repositories**: `UserRepository`, `PrismaUserRepository`
- **Mappers**: `UserMapper`
- **Events**: `UserCreatedEvent`, `ProjectUpdatedEvent`
- **Value Objects**: `Email`, `Password`

### Method Naming

- **CRUD Operations**: `create()`, `findAll()`, `findOne()`, `update()`, `remove()`
- **Business Logic**: `processPayment()`, `sendNotification()`, `validateUser()`
- **Event Handlers**: `handleUserCreated()`, `handleUserUpdated()`
- **Repository Methods**: `findById()`, `save()`, `delete()`, `findByEmail()`

## 5. Module Organization

### Feature Module Structure (Current Implementation)

**Note**: The current implementation uses a flat structure within the `application/` layer, organizing by type (services, use-cases, mappers) rather than by feature. This provides better code organization and reusability.

```bash
users/
├── users.module.ts
├── application/
│   ├── services/            # All service files grouped together
│   │   ├── users.service.ts
│   │   ├── users.service.spec.ts
│   │   └── users-pro-profile.service.ts
│   ├── use-cases/           # All use case files grouped together
│   │   ├── users.use-case.ts
│   │   ├── users.use-case.spec.ts
│   │   └── users-pro-profile.use-case.ts
│   └── mappers/             # All mapper files grouped together
│       ├── user.mapper.ts
│       ├── user.mapper.spec.ts
│       └── ...
├── domain/
│   ├── entities/            # All entity files
│   │   ├── user.entity.ts
│   │   ├── user.entity.spec.ts
│   │   └── ...
│   ├── repositories/        # Repository interfaces
│   │   ├── user.repository.ts
│   │   └── ...
│   └── events/              # Domain events
│       ├── user-created.event.ts
│       └── ...
└── infrastructure/
    ├── controllers/         # HTTP controllers
    │   ├── admin-users.controller.ts
    │   └── ...
    ├── repository/          # Repository implementations (singular)
    │   ├── mock-user.repository.ts
    │   └── ...
    ├── transformers/        # Response transformers
    │   └── ...
    └── notifications/       # Notification handlers
        └── ...
```

**Benefits of this structure:**

- Easier to find related files (all services together, all use cases together)
- Better code reusability
- Simpler imports
- Clear separation of concerns

### Shared Module Structure

```bash
common/
├── common.module.ts
├── decorators/
│   ├── current-user.decorator.ts
│   ├── roles.decorator.ts
│   └── api-response.decorator.ts
├── guards/
│   ├── jwt-auth.guard.ts
│   ├── roles.guard.ts
│   └── throttle.guard.ts
├── interceptors/
│   ├── logging.interceptor.ts
│   ├── transform.interceptor.ts
│   └── timeout.interceptor.ts
├── filters/
│   ├── http-exception.filter.ts
│   └── validation.filter.ts
└── pipes/
    ├── validation.pipe.ts
    └── parse-int.pipe.ts
```

## 6. Configuration Files

### TypeScript Configuration

```bash
tsconfig.json              # Root TypeScript configuration
tsconfig.base.json         # Base configuration for all projects
tsconfig.build.json        # Build-specific configuration
apps/*/tsconfig.app.json   # App-specific configurations
```

### NestJS Configuration

```bash
nest-cli.json             # NestJS CLI configuration
package.json              # Root package.json
apps/*/package.json       # App-specific package.json (if needed)
```

## 7. Testing Structure

### Test Organization

```bash
test/
├── unit/                  # Unit tests
│   ├── services/
│   ├── controllers/
│   ├── use-cases/
│   ├── entities/
│   └── mappers/
├── integration/           # Integration tests
│   ├── database/
│   ├── external-services/
│   └── api/
├── e2e/                  # End-to-end tests
│   ├── auth.e2e-spec.ts
│   └── user.e2e-spec.ts
├── fixtures/             # Test data and fixtures
│   └── users.fixture.ts
└── mocks/                # Mock implementations
    ├── repositories/
    └── services/
```

## 8. Environment Configuration

### Environment Files

```bash
.env                      # Default environment variables
.env.development          # Development environment
.env.staging              # Staging environment
.env.production           # Production environment
.env.test                 # Test environment
```

### Configuration Structure

```bash
config/
├── database.config.ts
├── jwt.config.ts
├── redis.config.ts
├── email.config.ts
├── logging.config.ts
└── validation.schema.ts
```

## 9. Documentation Structure

### Documentation Organization

```bash
docs/
├── api/                  # API documentation
│   ├── openapi.yaml
│   └── postman/
├── architecture/          # Architecture documentation
│   ├── overview.md
│   ├── decisions/
│   └── diagrams/
├── deployment/           # Deployment guides
│   ├── docker.md
│   ├── kubernetes.md
│   └── aws.md
└── development/          # Development guides
    ├── setup.md
    ├── contributing.md
    └── testing.md
```

## 10. Build and Deployment

### Build Artifacts

```bash
dist/                     # Build output
├── apps/
│   └── api-gateway/
└── libs/
    ├── common/
    ├── config/
    └── database/
```

### Docker Structure

```bash
docker/
├── Dockerfile.api-gateway
├── Dockerfile.user-service
├── docker-compose.yml
├── docker-compose.dev.yml
└── docker-compose.prod.yml
```

## 11. Git Organization

### Git Structure

```bash
.git/
├── hooks/                # Git hooks
├── templates/            # Git templates
└── config/              # Git configuration
```

### Git Ignore Patterns

```gitignore
# Dependencies
node_modules/
npm-debug.log*

# Build outputs
dist/
build/

# Environment files
.env
.env.local

# IDE files
.vscode/
.idea/

# OS files
.DS_Store
Thumbs.db

# Logs
logs/
*.log

# Coverage
coverage/
```

## 12. Import Organization

### Import Order

1. Node.js built-in modules
2. External libraries
3. Internal libraries (@libs/\*)
4. Relative imports (./, ../)
5. Type imports

### Import Examples

```typescript
// Node.js built-ins
import { join } from 'path';
import { readFileSync } from 'fs';

// External libraries
import { Injectable } from '@nestjs/common';

// Internal libraries
import { BaseEntity } from '@libs/entities';
import { CreateUserDto } from '@libs/contracts';
import { JwtAuthGuard } from '@libs/common';

// Relative imports
import { UserService } from './user.service';
import { UserRepository } from '../domain/user.repository';
```

## 13. Event-Driven Architecture

### Event Structure

```bash
events/
├── user-events.ts
└── base-events.ts
```

### Event Naming

- **Events**: `UserCreatedEvent`, `UserUpdatedEvent`
- **Event Handlers**: `handleUserCreated()`, `handleUserUpdated()`
- **Event Files**: `user-created.event.ts`, `user-updated.event.ts`

## 14. Repository Pattern

### Repository Structure

```bash
repositories/
├── interfaces/
│   ├── base.repository.interface.ts
│   └── user.repository.interface.ts
├── implementations/
│   ├── prisma/
│   │   └── prisma-user.repository.ts
│   └── mongo/
│       └── mongo-user.repository.ts
└── mappers/
    └── user.mapper.ts
```
